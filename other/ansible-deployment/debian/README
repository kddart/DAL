README file for KDDart deployment using ansible on Debian 11 based distribution
==============================================================================
This document provides a basic explanation on how to run a Ansible playbook script to deploy KDDart DAL in Debian 11 based distribution. It also lists the basic requirements to run the Ansible playbook script. This deployment script has been tested on Debian 11.

The main Ansible playbook script is kddart_dal_v2_6_0_server_deployment_debian11.yml in this directory.

Basic Requirements
------------------

1. Number of machines: At least two GNU/Linux machines are required.
 - One staging machine; and
 - One target machine.
 In the YML, there are lot of Ansible instructions and shell commands.
 When the YML is executed by ansible-playbook command, the instructions and shell commands in this YML will be executed in the target machine(s).

2. Staging machine: Requires Ansible version 2.1 or higher.

3. Target machine: Requires:

   * SSH connectivity in which root user in the staging machine ssh to the root user in target machine with password via ssh authorized keys.

   * HTTP access to the Internet to download the required packages and DAL code from github.com.

4. Operating System on target machine: The target machine requires:

   * OpenSuse 15.4 or Debian 11

   * Software package selection: Minimum or Compute Node

Step-by-step Instructions
-------------------------

The following instructions will deploy DAL for testing:

1. Install Debian 11 on the target machine:

   * Turn on network

   * Specify the root password.

2. Make sure there is network connectivity between the staging machine and the target machine.

3. Install Ansible 2.1 or higher on the staging machine.

4. Generate root SSH public/private key on the staging machine.

5. Copy the root public key on the staging machine to the root user in target machine by using ssh-copy-id command.
For example: ssh-copy-id root@target_machine_ip_address. You can use ssh-keygen to generate a new key.

6. Test the SSH without password from root user on the staging machine to root user on the target machine.

7. In /etc/ansible/hosts file on the staging machine, define:

[kddartserver]
x.x.x.x

and replace x.x.x.x with the IP address of the target machine

8. Run ansible-playbook kddart_dal_v2_7_0_server_deployment_debian11.yml.

ansible-playbook kddart_dal_v2_7_0_server_deployment_leap.yml --extra-vars="local_tar_gz_file='dal.tar.gz' ip_network='192.18.18.18/23' dal_address_name='kddart.example.com'"

Note: ip_network in the ansible script should include the subnet mask (e.g. 192.18.18.18/23)

For installtions without using the root user, add the following flags to the ansible-playbook command to use a user that has sudo privileges.

--ask-pass -b -K -u [username]

9. Login as root to the target machine and execute /root/KDDArT-DAL-v2.7.0/other/run_create_empty_dbs.sh

10. Restart target machine. It must be done before proceeding to the next instruction.

11. Check services on the target machine:

    * Check MySQL service command: `systemctl status mysql`
    * Check PostgreSQL service command: `systemctl status postgresql`
    * Check MonetDB service: `ps aux | grep 'monetdbd'` if there are two processes matched, MonetDB service is running. If there is only one process match, then run `/usr/local/bin/monetdbd start /var/lib/monetdb/dbfarm;`    
   * Check SOLR service command: `systemctl status solr`
      * SOLR service can be run with the command: `systemctl start solr`    


12. As root on the target machine, run:

perl -w /root/KDDArT-DAL-v2.7.0/other/dal_access_test.pl "http://kddart.example.com/dal" admin kddartadmin 0

Note: http://kddart.example.com/dal should be replaced with the URL of your new DAL installation. 

13. As root on the target machine, run:

    * cd /root/KDDArT-DAL-v2.7.0/other/whitebox_test_cases/TestSuite

    * While in the TestSuite directory, run:
      perl -w kddart_dal_test.pl 2 xml/add_data_no_vcol/test_order_all.txt

14. Deploy KDManage - please follow KDManage ansible deployment instructions in a separate package.

Note: Once all installation has been satisfied, in order to to clean up the data generated by running test cases in the instruction 13 and load a demo database, you need to run:

    * /root/KDDArT-DAL-v2.7.0/other/run_create_demo_dbs.sh
